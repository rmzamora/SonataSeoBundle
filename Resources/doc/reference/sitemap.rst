Sitemap
=======

The ``SonataSeoBundle`` provides a support for static sitemap generation.

You will need to configure:
 - a Doctrine connection
 - a route
 - default parameters used by the route
 - the query which must contains all informations required by a sitemap: lastmod, changefreq and prioriy

The url is generated by using ``route`` and ``parameters`` settings.

For performance reasons and memory usage there is no model hydrated while generating the sitemap. So if the sitemap requires
specific rules, they must be expressed in the ``WHERE`` condition. The query must select fields to be used in the route.

The following code is an extract of the query required to generate a valid sitemap for the ``SonataNewsBundle``

.. code-block:: sql

    SELECT
        CONCAT_WS('/', YEAR(created_at), MONTH(created_at), DAY(created_at), slug) as permalink ,
        updated_at as lastmod,
        'weekly' as changefreq,
        '0.5' as priority
    FROM news__post
    WHERE
            enabled = 1
        AND (publication_date_start IS NULL OR publication_date_start <= NOW())


Please note: the ``changefreq`` and the ``priority`` fields are optional.

Configuration
-------------

.. code-block:: yaml

    sonata_seo:
        # ...
        sitemap:
            doctrine_orm:
                - { types: [image], connection: doctrine.dbal.default_connection, route: sonata_media_view, parameters: {id: null}, query: "SELECT id, updated_at as lastmod, 'weekly' as changefreq, '0.5' as priority FROM media__media WHERE enabled = true" }
                - { group: "news",  connection: doctrine.dbal.default_connection, route: sonata_news_view, parameters: {permalink: null}, query: "SELECT CONCAT_WS('/', YEAR(created_at), MONTH(created_at), DAY(created_at), slug) as permalink , updated_at as lastmod, 'weekly' as changefreq, '0.5' as priority FROM news__post WHERE enabled = 1 AND (publication_date_start IS NULL OR publication_date_start <= NOW())" }


Usage
-----

- Generate the sitemap::

    php app/console sonata:seo:sitemap web sonata-project.org
